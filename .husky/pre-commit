#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Warna terminal (jika didukung)
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
RESET='\033[0m'

echo "${CYAN}ğŸš€ Starting pre-commit checks...${RESET}"

# Step 1: Lint-staged
echo "${YELLOW}ğŸ” Running lint-staged...${RESET}"
if ! npx lint-staged; then
  echo "${RED}âŒ Linting/formatting failed. Please fix the issues before committing.${RESET}"
  exit 1
fi

# Step 2: Build project
echo "${YELLOW}ğŸ—ï¸  Verifying project builds successfully...${RESET}"
if ! npm run build; then
  echo "${RED}âŒ Build failed. Please fix the errors before committing.${RESET}"
  exit 1
fi

# Step 3: Run tests (if test script exists)
if npm run | grep -q "^ *test"; then
  echo "${YELLOW}ğŸ§ª Running tests...${RESET}"
  if ! npm test -- --watchAll=false; then
    echo "${RED}âŒ Some tests failed. Please fix them before committing.${RESET}"
    exit 1
  fi
else
  echo "${CYAN}â„¹ï¸ No test script found. Skipping tests.${RESET}"
fi

# Final message
echo "${GREEN}âœ… All checks passed. Proceeding with commit...${RESET}"
exit 0
