#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸš€ Starting pre-commit checks..."

echo "ğŸ” Running lint-staged..."
if ! npx lint-staged; then
  echo "âŒ Linting/formatting failed. Please fix the issues before commit."
  exit 1
fi

echo "ğŸ—ï¸ Running build to verify the project integrity..."
if ! npm run build; then
  echo "âŒ Build failed. Please fix the errors above before commit."
  exit 1
fi

if npm run | grep -q "test"; then
  echo "ğŸ§ª Running tests..."
  if ! npm test -- --watchAll=false; then
    echo "âŒ Tests failed. Please fix the failing tests before commit."
    exit 1
  fi
else
  echo "â„¹ï¸ No test script found. Skipping tests."
fi

echo "âœ… All pre-commit checks passed. Proceeding with commit..."

exit 0
